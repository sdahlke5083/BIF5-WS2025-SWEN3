﻿@using System
@using Microsoft.AspNetCore.Components

<div class="doc-item-grid">
    <!-- 25%: Thumbnail -->
    <div class="doc-item-thumb">
        @if (!string.IsNullOrWhiteSpace(ThumbnailDataUrl))
        {
            <img src="@ThumbnailDataUrl" alt="Preview" />
        }
        else
        {
            <div class="doc-item-thumb-empty">
                <b>(no preview)</b>
            </div>
        }
    </div>

    <!-- 25%: OCR + Summary (dropdowns) -->
    <div class="doc-item-details">
        <div class="doc-item-header">
            <div class="doc-item-title">@Title</div>
            <div class="doc-item-sub">
                Uploaded: @(UploadedAt?.ToLocalTime().ToString("yyyy-MM-dd HH:mm") ?? "unknown")
            </div>
        </div>

        @ChildContent
    </div>

    <!-- 50%: Metadata panel (different tone) -->
    <div class="doc-item-meta">
        <div class="doc-item-meta-inner">
            @if (MetadataContent is not null)
            {
                @MetadataContent
            }
            else
            {
                <div class="doc-item-meta-title">Metadata</div>

                <div class="doc-item-meta-grid">
                    <div class="meta-label">Document Id</div>
                    <div class="meta-value">@(DocumentId?.ToString() ?? "-")</div>

                    <div class="meta-label">Title</div>
                    <div class="meta-value">@(!string.IsNullOrWhiteSpace(MetaTitle) ? MetaTitle : "-")</div>

                    <div class="meta-label">Description</div>
                    <div class="meta-value">@(!string.IsNullOrWhiteSpace(MetaDescription) ? MetaDescription : "-")</div>

                    <div class="meta-label">Language</div>
                    <div class="meta-value">@(!string.IsNullOrWhiteSpace(MetaLanguageCode) ? MetaLanguageCode : "-")</div>

                    <div class="meta-label">Created</div>
                    <div class="meta-value">@(MetaCreatedAt?.ToLocalTime().ToString("yyyy-MM-dd HH:mm") ?? "-")</div>

                    <div class="meta-label">Size</div>
                    <div class="meta-value">@(MetaSizeBytes.HasValue? FormatBytes(MetaSizeBytes.Value) : "-")</div>
                </div>
            }
        </div>
    </div>
</div>

@code
{
    [Parameter] public string? Title { get; set; }
    [Parameter] public DateTimeOffset? UploadedAt { get; set; }
    [Parameter] public string? ThumbnailDataUrl { get; set; }

    // Optional metadata (right 50%)
    [Parameter] public Guid? DocumentId { get; set; }
    [Parameter] public string? MetaTitle { get; set; }
    [Parameter] public string? MetaDescription { get; set; }
    [Parameter] public string? MetaLanguageCode { get; set; }
    [Parameter] public DateTimeOffset? MetaCreatedAt { get; set; }
    [Parameter] public long? MetaSizeBytes { get; set; }

    [Parameter] public RenderFragment? MetadataContent { get; set; }

    // OCR + Summary dropdowns live  (middle 25%).
    [Parameter] public RenderFragment? ChildContent { get; set; }

    private static string FormatBytes(long bytes)
    {
        const long KB = 1024;
        const long MB = KB * 1024;
        const long GB = MB * 1024;

        if (bytes >= GB) return $"{bytes / (double)GB:0.##} GB";
        if (bytes >= MB) return $"{bytes / (double)MB:0.##} MB";
        if (bytes >= KB) return $"{bytes / (double)KB:0.##} KB";
        return $"{bytes} B";
    }
}
