@page "/search"
@using System
@using System.Collections.Generic
@using System.Threading.Tasks

<h3>Search Documents</h3>

<div class="mb-3">
    <input class="form-control" @bind="Query" placeholder="Enter search text" />
</div>
<div class="mb-3">
    <button class="btn btn-primary" @onclick="DoSearch">Search</button>
</div>

@if (IsLoading)
{
    <p>Searching…</p>
}
else if (Results is not null)
{
    <h5>Results</h5>
    @if (Results.Count == 0)
    {
        <p>No results.</p>
    }
    else
    {
        <ul class="list-group">
            @foreach (var r in Results)
            {
                <li class="list-group-item">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="fw-bold">@(!string.IsNullOrWhiteSpace(r.fileName) ? r.fileName : "(unknown)")</div>
                            <div class="text-muted" style="font-size: 0.9em;">
                                Uploaded: @(r.uploadedAt?.ToLocalTime().ToString("yyyy-MM-dd HH:mm") ?? "unknown")
                            </div>

                            <details class="mt-2">
                                <summary><strong>OCR</strong></summary>
                                @if (!string.IsNullOrWhiteSpace(r.ocrPreview))
                                {
                                    <div class="mt-2">@r.ocrPreview</div>
                                }
                                else
                                {
                                    <div class="mt-2 text-muted">(not available yet)</div>
                                }
                            </details>

                            <details class="mt-2">
                                <summary><strong>Summary</strong></summary>
                                @if (!string.IsNullOrWhiteSpace(r.summaryPreview))
                                {
                                    <div class="mt-2">@r.summaryPreview</div>
                                }
                                else
                                {
                                    <div class="mt-2 text-muted">(not available yet)</div>
                                }
                            </details>
                        </div>
                    </div>
                </li>
            }
        </ul>
    }
}
