@page "/search"

<h3>Search Documents</h3>

<div class="mb-3">
    <input class="form-control" @bind="Query" placeholder="Enter search text" />
</div>
<div class="mb-3">
    <button class="btn btn-primary" @onclick="DoSearch">Search</button>
</div>

@if (IsLoading)
{
    <p>Searching...</p>
}
else if (Results is not null)
{
    <h5>Results</h5>
    @if (Results.Count == 0)
    {
        <p>No results.</p>
    }
    else
    {
        <ul class="list-group">
            @foreach (var r in Results)
            {
                <li class="list-group-item">
                    <DocumentListItem Title="@(!string.IsNullOrWhiteSpace(r.FileName) ? r.FileName : "(unknown)")"
                                      UploadedAt="@r.UploadedAt"
                                      ThumbnailDataUrl="@r.ThumbnailDataUrl">
                        <details class="mt-2">
                            <summary><strong>OCR</strong></summary>
                            @if (!string.IsNullOrWhiteSpace(r.OcrPreview))
                            {
                                <pre class="mt-2" style="white-space: pre-wrap;">@r.OcrPreview</pre>
                            }
                            else
                            {
                                <div class="mt-2 text-muted">(not available yet)</div>
                            }
                        </details>

                        <details class="mt-2">
                            <summary><strong>Summary</strong></summary>
                            @if (!string.IsNullOrWhiteSpace(r.SummaryPreview))
                            {
                                <pre class="mt-2" style="white-space: pre-wrap;">@r.SummaryPreview</pre>
                            }
                            else
                            {
                                <div class="mt-2 text-muted">(not available yet)</div>
                            }
                        </details>
                    </DocumentListItem>
                </li>
            }
        </ul>
    }
}
